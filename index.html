<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>夏至</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="不懂产品的前端，不是优秀的Ios工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="夏至">
<meta property="og:url" content="http://yoursite.com/">
<meta property="og:site_name" content="夏至">
<meta property="og:description" content="不懂产品的前端，不是优秀的Ios工程师">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="夏至">
<meta name="twitter:description" content="不懂产品的前端，不是优秀的Ios工程师">

  
    <link rel="alternative" href="/atom.xml" title="夏至" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">夏至</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">前端朝圣客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="yoursite.com">
        </form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-README" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/11/README/" class="article-date">
  <time datetime="2015-05-11T10:27:40.000Z" itemprop="datePublished">May 11 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="github地址">github地址</h3>
<pre><code><span class="label">https:</span>//github<span class="preprocessor">.com</span>/kingundertree/XZNetworking
</code></pre><h3 id="Pod支持">Pod支持</h3>
<pre><code>pod <span class="string">'XZNetworking'</span>, <span class="symbol">:git</span> =&gt; <span class="string">'https://github.com/kingundertree/XZNetworking'</span>
</code></pre><h3 id="Demo">Demo</h3>
<pre><code><span class="label">https:</span>//github<span class="preprocessor">.com</span>/kingundertree/XZNetworkingDemo
</code></pre><h3 id="功能">功能</h3>
<pre><code><span class="bullet">1. </span>支持get请求，包括同步/异步
<span class="bullet">2. </span>支持post请求，包括同步/异步
<span class="bullet">3. </span>支持restfulGet请求，包括同步/异步
<span class="bullet">4. </span>支持restfulPost请求，包括同步/异步
<span class="bullet">5. </span>支持请求细节日志打印，包括request、header、body、response等细节信息
<span class="bullet">6. </span>支持系统参数传递
</code></pre><h3 id="实现机制">实现机制</h3>
<pre><code><span class="bullet">1. </span>基于AFNetworking
<span class="bullet">2. </span>通过NSOperationQueen管理所有的请求
</code></pre><h3 id="补充">补充</h3>
<pre><code>1.支持AFNetworking切换其他第三方网络库，需要单独处理请求成功回调逻辑
2.可以支持加密等处理
</code></pre><h3 id="代码片段">代码片段</h3>
<h4 id="get请求">get请求</h4>
<pre><code>#pragma mark - get Request
- (void)getRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"songIds":@"15702101"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">data</span>/<span class="title">music</span>/<span class="title">links</span>";</span>

    [[XZRequestManager shareInstance] asyncGetWithServiceID:XZNetworkingGetServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(getRequestReturn:)];
}

- (void)getRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="post请求">post请求</h4>
<pre><code>#pragma mark - post Request
- (void)postRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"log" : @"testtest"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">admin</span>.<span class="title">writeCrashLog</span>";</span>

    [[XZRequestManager shareInstance] asyncPostWithServiceID:XZNetworkingPostServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(postRequestReturn:)];
}

- (void)postRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="restfulGet请求">restfulGet请求</h4>
<pre><code>#pragma mark - restfulGet Request
- (void)restfulGetMethodTest <span class="comment">{
    NSDictionary *params = @{@"cityId":@"41"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">anjuke</span>/<span class="title">prop</span>/<span class="title">getconfig</span>/";</span>

    [[XZRequestManager shareInstance] asyncRESTGetWithServiceID:XZNetworkingRestfulGetServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(restfulGetRequestReturn:)];
}

- (void)restfulGetRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="restfulPost">restfulPost</h4>
<pre><code>#pragma mark - restfulPost Request
- (void)restfulPostRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"brokerId":@"1512265",@"chatFlag":@"1",@"cityId":@"41",@"token":@"ac69cf3c7cd1c116f41e5686928bfef6"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">broker</span>/<span class="title">getinfoandppc</span>/";</span>

    [[XZRequestManager shareInstance] asyncRESTPostWithServiceID:XZNetworkingRestfulPostServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(restfulPostRequestReturn:)];
}

- (void)restfulPostRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/05/11/README/" data-id="q21qsve9ak5xl0qx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-XZNetworking请求库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/11/XZNetworking请求库/" class="article-date">
  <time datetime="2015-05-10T16:00:00.000Z" itemprop="datePublished">May 11 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/XZNetworking/">XZNetworking</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/11/XZNetworking请求库/">XZNetworking 支持get/post/restfulGet/restfulPost请求</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="github地址">github地址</h3>
<pre><code><span class="label">https:</span>//github<span class="preprocessor">.com</span>/kingundertree/XZNetworking
</code></pre><h3 id="Pod支持">Pod支持</h3>
<pre><code>pod <span class="string">'XZNetworking'</span>, <span class="symbol">:git</span> =&gt; <span class="string">'https://github.com/kingundertree/XZNetworking'</span>
</code></pre><h3 id="Demo">Demo</h3>
<pre><code><span class="label">https:</span>//github<span class="preprocessor">.com</span>/kingundertree/XZNetworkingDemo
</code></pre><h3 id="功能">功能</h3>
<pre><code><span class="bullet">1. </span>支持get请求，包括同步/异步
<span class="bullet">2. </span>支持post请求，包括同步/异步
<span class="bullet">3. </span>支持restfulGet请求，包括同步/异步
<span class="bullet">4. </span>支持restfulPost请求，包括同步/异步
<span class="bullet">5. </span>支持请求细节日志打印，包括request、header、body、response等细节信息
<span class="bullet">6. </span>支持系统参数传递
</code></pre><h3 id="实现机制">实现机制</h3>
<pre><code><span class="bullet">1. </span>基于AFNetworking
<span class="bullet">2. </span>通过NSOperationQueen管理所有的请求
</code></pre><h3 id="补充">补充</h3>
<pre><code>1.支持AFNetworking切换其他第三方网络库，需要单独处理请求成功回调逻辑
2.可以支持加密等处理
</code></pre><h3 id="代码片段">代码片段</h3>
<h4 id="get请求">get请求</h4>
<pre><code>#pragma mark - get Request
- (void)getRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"songIds":@"15702101"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">data</span>/<span class="title">music</span>/<span class="title">links</span>";</span>

    [[XZRequestManager shareInstance] asyncGetWithServiceID:XZNetworkingGetServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(getRequestReturn:)];
}

- (void)getRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="post请求">post请求</h4>
<pre><code>#pragma mark - post Request
- (void)postRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"log" : @"testtest"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">admin</span>.<span class="title">writeCrashLog</span>";</span>

    [[XZRequestManager shareInstance] asyncPostWithServiceID:XZNetworkingPostServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(postRequestReturn:)];
}

- (void)postRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="restfulGet请求">restfulGet请求</h4>
<pre><code>#pragma mark - restfulGet Request
- (void)restfulGetMethodTest <span class="comment">{
    NSDictionary *params = @{@"cityId":@"41"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">anjuke</span>/<span class="title">prop</span>/<span class="title">getconfig</span>/";</span>

    [[XZRequestManager shareInstance] asyncRESTGetWithServiceID:XZNetworkingRestfulGetServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(restfulGetRequestReturn:)];
}

- (void)restfulGetRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre><h4 id="restfulPost">restfulPost</h4>
<pre><code>#pragma mark - restfulPost Request
- (void)restfulPostRequestMethodTest <span class="comment">{
    NSDictionary *params = @{@"brokerId":@"1512265",@"chatFlag":@"1",@"cityId":@"41",@"token":@"ac69cf3c7cd1c116f41e5686928bfef6"}</span>;
    NSString *<span class="function"><span class="keyword">method</span> = @"<span class="title">broker</span>/<span class="title">getinfoandppc</span>/";</span>

    [[XZRequestManager shareInstance] asyncRESTPostWithServiceID:XZNetworkingRestfulPostServiceID methodName:<span class="function"><span class="keyword">method</span> <span class="title">params</span>:</span><span class="keyword">params</span> target:<span class="keyword">self</span> action:@<span class="keyword">selector</span>(restfulPostRequestReturn:)];
}

- (void)restfulPostRequestReturn:(XZRequestResponse *)response <span class="comment">{
    NSLog(@"response----&gt;&gt;%@",response.content);
}</span>
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/05/11/XZNetworking请求库/" data-id="1zk6hf5ztjyiyymt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XZNetworking/">XZNetworking</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-XZMusic构架设计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/02/XZMusic构架设计/" class="article-date">
  <time datetime="2015-05-01T16:00:00.000Z" itemprop="datePublished">May 2 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/XZMusic/">XZMusic</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/02/XZMusic构架设计/">XZMusic构架设计</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/XZMusic/master/XZMusic.gif" alt="XZMusic"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/XZMusic" target="_blank" rel="external">https://github.com/kingundertree/XZMusic</a></p>
<h3 id="说明">说明</h3>
<ol>
<li>本md主要主要通过XZMusic分析下常见的iOS项目的搭建以及常见模块的设计和划分</li>
<li>本项目的音乐信息取自本地SQL数据，通过FMDB获取</li>
<li>音乐的统计信息采用CoreData实现</li>
<li>歌曲资源和歌词取自网络</li>
<li>播放器采用DOUAudio</li>
<li>采用pod方式管理第三方库</li>
</ol>
<h3 id="功能">功能</h3>
<ol>
<li>本地搜索歌曲</li>
<li>歌曲播放和下载、显示歌词</li>
<li>歌曲的基本统计，包括点赞、播放次数等</li>
<li>微博登录</li>
</ol>
<h3 id="主要模块">主要模块</h3>
<ol>
<li>网络请求模块XZNetWorking：集成AFNetworking，支持常见的get/post/restfulget/getfulget常见请求</li>
<li>音乐下载模块MusicDownLoad：支持歌曲、歌词下载，包括本地存储处理，已经下载进度及常见信息回调</li>
<li>微博登录libWeiboSDK：配合LoginManager使用</li>
<li>UI主结构XZMenu：实现左右结构，滑动显示菜单</li>
<li>UITabBar结构XZTabBar</li>
</ol>
<h3 id="构架设计">构架设计</h3>
<pre><code>XZMusic
    <span class="built_in">Data</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>本地化数据处理，包括本地音乐信息及音乐统计停息
        XZMusicDataCenter<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>coredata表信息输入输出接口
        LKDBCenter<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>SQL表信息输入输出接口
        Model<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>本地数据库数据模型
    Libs<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>不支持pod的库
        DOUAudio<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>音乐播放，支持在线播放
        XZNetWorking<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>网络请求库，集成AFNetworking库
        libWeiboSDK<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>微博登录SDK
    Manager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>APP业务操作管理类
        GlobalManager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>app全局性参数管理，比如当前播放musicId、列表信息，以及下载的实时信息
        MusicDownLoad<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>下载功能模块，支持音乐和歌词下载，本地存储处理，已经下载进度及常见信息回调
        RequestManager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>网络请求的请求
        LoginManager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>登录操作管理
    Model<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>app常见业务的model
    Resource<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>常见资源，包括图片等
    Views<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>视图资源，也就是app最重要的模块
        component<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>通用的view类，包括base VC、table、Category、手势控件等
        DownLoad<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>下载VC
        Login<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>登录VC
        Loving<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>最爱VC
        Search<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>搜索VC
        Setting<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>设置VC
        ViewController<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>子页面VC
        XZMenu<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>app主view结构
        XZTabBar<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>UITabbar自定义结构
    XZAppDelegate<span class="built_in">.</span>h
    XZAppDelegate<span class="built_in">.</span>m

Pods<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>支持第三方的类库

    platform :ios, <span class="string">"6.0"</span>
    pod <span class="string">'AFNetworking'</span>, <span class="string">'~&gt; 2.0'</span>
    pod <span class="string">'pop'</span>, <span class="string">'~&gt; 1.0'</span>
    pod <span class="string">'FMDB'</span>
    pod <span class="string">'LKDBHelper'</span>, :head
    pod <span class="string">'MBProgressHUD'</span>, <span class="string">'~&gt; 0.8'</span>
    pod <span class="string">'MultiFunctionCell'</span>, :git <span class="subst">=&gt;</span> <span class="string">'https://github.com/kingundertree/MultiFunctionCell'</span>
</code></pre><h3 id="补充">补充</h3>
<ol>
<li>后面的文章中单独对下载模块和网络请求模块的设计做详细阐述</li>
<li>本项目的设计还有很多不足之处，主要体现在UI的左右结构设计和GCD使用还不够熟练</li>
</ol>
<h4 id="时间记录">时间记录</h4>
<ol>
<li>2014.8.22 周浦万达广场麦当劳，创建项目，实现pod管理和基本配置</li>
<li>2014.8.28 公司，完成左右菜单结构，以及基本TabBar功能</li>
<li>2014.8.29 公司，结构完善，引入手势控件</li>
<li>2014.8.31 临港豪生，实现左侧菜单切换基本功能</li>
<li>2014.9.22 实现微博登录和登录后信息</li>
<li>2014.10.22 逐步实现asyncGetWithServiceID和的同步和异步方法，流程走通，待测试</li>
<li>2014.10.29 调试url参数，service阶段</li>
<li>2013.11.2 调试XZNetWork Get请求成功。api请求告一段落</li>
<li>add LKDBHelper，实现歌手列表搜索，需要设计搜索模块</li>
<li>add search singerList ViewController</li>
<li>add search singerSongs Request</li>
<li>11.13 add DOUAudioPlayer 实现播放歌曲功能</li>
<li>11.22 实现本地音乐、歌词下载，以及本地播放功能</li>
<li>11.23 实现歌词播放，进度同步</li>
<li>12.2 add 播放暂停控制，以及其他ui</li>
<li>12.6 add 子view 下载功能</li>
<li>12.14 add 歌曲播放数据库读写记录操作</li>
</ol>
<h3 id="需要fix_方法">需要fix 方法</h3>
<p>LKDBHelper.m</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (instancetype)init</div><div class="line">{</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithDBName:@<span class="string">"FreeMusic"</span>];</div><div class="line">}</div><div class="line"></div><div class="line">+(<span class="built_in">NSString</span>*)getDBPathWithDBName:(<span class="built_in">NSString</span>*)dbName</div><div class="line">{</div><div class="line">    <span class="built_in">NSString</span>* fileName = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">if</span>([dbName hasSuffix:@<span class="string">".db"</span>] == <span class="literal">NO</span>) {</div><div class="line">        fileName = [<span class="built_in">NSString</span> stringWithFormat:@<span class="string">"%@.db"</span>,dbName];</div><div class="line">    }</div><div class="line">    <span class="keyword">else</span> {</div><div class="line">        fileName = dbName;</div><div class="line">    }</div><div class="line">    </div><div class="line"><span class="comment">//    NSString* filePath = [LKDBUtils getPathForDocuments:fileName inDir:@"db"];</span></div><div class="line">    <span class="built_in">NSString</span>* filePath = [LKDBUtils getPathForDocuments:fileName inDir:<span class="literal">nil</span>];</div><div class="line">    <span class="keyword">return</span> filePath;</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/05/02/XZMusic构架设计/" data-id="izkx96f9ade88mbo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XZMusic/">XZMusic</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-多任务下载(支持后台下载)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/02/多任务下载(支持后台下载)/" class="article-date">
  <time datetime="2015-05-01T16:00:00.000Z" itemprop="datePublished">May 2 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/XZDownloadTask/">XZDownloadTask</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/02/多任务下载(支持后台下载)/">多任务下载(支持后台下载)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/XZDownloadTask/master/XZDownlod.gif" alt="XZDownloadTask"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/XZDownloadTask" target="_blank" rel="external">https://github.com/kingundertree/XZDownloadTask</a></p>
<h3 id="说明">说明</h3>
<p>之前坐过几版下载的demo，要么不支持多任务、要么不支持后台下载或者对设计不满意。</p>
<p>这次重新设计新的模块，支持单任务、多任务、后台下载。</p>
<p>保留一个彩蛋，供下次优化。</p>
<h3 id="功能">功能</h3>
<ol>
<li>支持单个任务下载，实现下载、暂停、重新下载、取消等。</li>
<li>单个任务支持后台下载，下载内容存储和下载信息回调，包括下载存储url和下载进度</li>
<li>支持多任务下载，包括批量下载、批量暂停、批量取消、批量重启。支持单个任务设置是否后台下载。同样支持单个任务的进度等信息回调。</li>
</ol>
<h3 id="实现机制">实现机制</h3>
<ol>
<li>下载基于iOS7 NSURLSessionDownloadTask 实现，通过配置NSUrlSession实现</li>
<li>通过NSURLSession配置backgroundSessionConfigurationWithIdentifier，实现后台下载</li>
<li>通过NSURLSession配置defaultSessionConfiguration，实现普通下载</li>
<li>通过NSURLSessionDownloadDelegate的代理方法，获取下载进度进度、下载成功失败以及后台下载完成信息</li>
</ol>
<h3 id="设计模式">设计模式</h3>
<pre><code>XZDownloadTask<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>下载类
    XZDownloadManager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>下载主功能实现区
    XZDownloadGroupManager<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span>多人下载管理类
    XZDownloadElement<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span>每个下载任务的辅助类
    XZDownloadResponse<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>下载成功失败进度的响应类
</code></pre><h3 id="单任务下载实现">单任务下载实现</h3>
<p>1.创建下载任务<br>    通过isDownloadBackground分别创建常规下载任务或后台下载任务。</p>
<pre><code>- (<span class="keyword">void</span>)configDownloadInfo:(<span class="built_in">NSString</span> *) downloadStr isDownloadBackground:(<span class="built_in">BOOL</span>)isDownloadBackground identifier:(<span class="built_in">NSString</span> *)identifier succuss:(<span class="keyword">void</span> (^)(XZDownloadResponse *response)) succuss fail:(<span class="keyword">void</span>(^)(XZDownloadResponse *response)) fail progress:(<span class="keyword">void</span>(^)(XZDownloadResponse *response)) progress cancle:(<span class="keyword">void</span>(^)(XZDownloadResponse *response)) cancle pause:(<span class="keyword">void</span>(^)(XZDownloadResponse *response)) pause resume:(<span class="keyword">void</span>(^)(XZDownloadResponse *response)) resume{
    <span class="keyword">self</span><span class="variable">.downloadSuccuss</span> = succuss;
    <span class="keyword">self</span><span class="variable">.downloadFail</span> = fail;
    <span class="keyword">self</span><span class="variable">.downloadProgress</span> = progress;
    <span class="keyword">self</span><span class="variable">.downloadCancle</span> = cancle;
    <span class="keyword">self</span><span class="variable">.downloadPause</span> = pause;
    <span class="keyword">self</span><span class="variable">.downloadResume</span> = resume;

    <span class="keyword">self</span><span class="variable">.identifier</span> = identifier ? identifier : [[NSProcessInfo processInfo] globallyUniqueString];

    <span class="keyword">if</span> (isDownloadBackground) {
        [<span class="keyword">self</span> startBackgroundDownload:downloadStr identifier:<span class="keyword">self</span><span class="variable">.identifier</span>];
    } <span class="keyword">else</span> {
        [<span class="keyword">self</span> startNormalDownload:downloadStr];
    }
}
</code></pre><p>2.常规下载任务</p>
<pre><code>- (<span class="keyword">void</span>)startNormalDownload:(<span class="built_in">NSString</span> *)downloadStr {
    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:downloadStr]];
    <span class="keyword">self</span><span class="variable">.normalSessionTask</span> = [<span class="keyword">self</span><span class="variable">.normalSession</span> downloadTaskWithRequest:request];
    [<span class="keyword">self</span><span class="variable">.normalSessionTask</span> resume];
}

- (NSURLSession *)normalSession {
    <span class="keyword">if</span> (!_normalSession) {
        NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];
        _normalSession = [NSURLSession sessionWithConfiguration:sessionConfig delegate:<span class="keyword">self</span> delegateQueue:<span class="literal">nil</span>];
        _normalSession<span class="variable">.sessionDescription</span> = @<span class="string">"normal NSURLSession"</span>;
    }

    <span class="keyword">return</span> _normalSession;
}
</code></pre><p>3.后台下载任务</p>
<pre><code>- (<span class="keyword">void</span>)startBackgroundDownload:(<span class="built_in">NSString</span> *)downloadStr identifier:(<span class="built_in">NSString</span> *)identifier {
    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:downloadStr]];
    <span class="keyword">self</span><span class="variable">.backgroundSession</span> = [<span class="keyword">self</span> getBackgroundSession:identifier];
    <span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> = [<span class="keyword">self</span><span class="variable">.backgroundSession</span> downloadTaskWithRequest:request];
    [<span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> resume];
}

- (NSURLSession *)getBackgroundSession:(<span class="built_in">NSString</span> *)identifier {
    NSURLSession *backgroundSession = <span class="literal">nil</span>;
    NSURLSessionConfiguration *config = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:[<span class="built_in">NSString</span> stringWithFormat:@<span class="string">"background-NSURLSession-%@"</span>,identifier]];
    config<span class="variable">.HTTPMaximumConnectionsPerHost</span> = <span class="number">5</span>;
    backgroundSession = [NSURLSession sessionWithConfiguration:config delegate:<span class="keyword">self</span> delegateQueue:<span class="literal">nil</span>];

    <span class="keyword">return</span> backgroundSession;
}
</code></pre><p>4.暂停下载任务</p>
<p>核心方法cancelByProducingResumeData</p>
<pre><code>- (<span class="keyword">void</span>)pauseDownload {
    __<span class="keyword">weak</span> typeof(<span class="keyword">self</span>) <span class="keyword">this</span> = <span class="keyword">self</span>;
    <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.normalSessionTask</span>) {
        [<span class="keyword">self</span><span class="variable">.normalSessionTask</span> cancelByProducingResumeData:^(NSData *resumeData) {
            <span class="keyword">this</span><span class="variable">.partialData</span> = resumeData;
            <span class="keyword">this</span><span class="variable">.normalSessionTask</span> = <span class="literal">nil</span>;
        }];
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.backgroundSessionTask</span>) {
        [<span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> cancelByProducingResumeData:^(NSData *resumeData) {
            <span class="keyword">this</span><span class="variable">.partialData</span> = resumeData;
        }];
    }
}
</code></pre><p>4.重启下载任务</p>
<p>核心方法downloadTaskWithResumeData</p>
<pre><code>- (<span class="keyword">void</span>)resumeDownload {
    <span class="keyword">if</span> (!<span class="keyword">self</span><span class="variable">.resumeSessionTask</span>) {
        <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.partialData</span>) {
            <span class="keyword">self</span><span class="variable">.resumeSessionTask</span> = [<span class="keyword">self</span><span class="variable">.normalSession</span> downloadTaskWithResumeData:<span class="keyword">self</span><span class="variable">.partialData</span>];

            [<span class="keyword">self</span><span class="variable">.resumeSessionTask</span> resume];
        }
    }
}    
</code></pre><p>5.取消下载任务</p>
<p>核心方法cancel</p>
<pre><code>- (<span class="keyword">void</span>)cancleDownload {
    <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.normalSessionTask</span>) {
        [<span class="keyword">self</span><span class="variable">.normalSessionTask</span> cancel];
        <span class="keyword">self</span><span class="variable">.normalSessionTask</span> = <span class="literal">nil</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.resumeSessionTask</span>) {
        <span class="keyword">self</span><span class="variable">.partialData</span> = <span class="literal">nil</span>;
        [<span class="keyword">self</span><span class="variable">.resumeSessionTask</span> cancel];
        <span class="keyword">self</span><span class="variable">.resumeSessionTask</span> = <span class="literal">nil</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.backgroundSessionTask</span>) {
        [<span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> cancel];
        <span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> = <span class="literal">nil</span>;
    }    
}            
</code></pre><p>6.后台下载成功后回调    </p>
<pre><code><span class="pp">- <span class="params">(void)</span>application:<span class="params">(<span class="variable">UIApplication</span> *)</span>application handleEventsForBackgroundURLSession:<span class="params">(<span class="variable">NSString</span> *)</span>identifier completionHandler:<span class="params">(void (^)</span><span class="params">()</span>)completionHandler
{
    self</span>.background<span class="variable">URLSessionCompletionHandler</span> = completion<span class="variable">Handler</span>;
}
</code></pre><p>7.后台下载成功后回调    </p>
<pre><code><span class="pp">- <span class="params">(void)</span>application:<span class="params">(<span class="variable">UIApplication</span> *)</span>application handleEventsForBackgroundURLSession:<span class="params">(<span class="variable">NSString</span> *)</span>identifier completionHandler:<span class="params">(void (^)</span><span class="params">()</span>)completionHandler
{
    self</span>.background<span class="variable">URLSessionCompletionHandler</span> = completion<span class="variable">Handler</span>;
}
</code></pre><p>8.后台下载成功后回调NSURLSessionDownloadDelegate    </p>
<p>下载中，处理下载进度</p>
<pre><code><span class="pp">- <span class="params">(void)</span>URLSession:<span class="params">(<span class="variable">NSURLSession</span> *)</span>session downloadTask:<span class="params">(<span class="variable">NSURLSessionDownloadTask</span> *)</span>downloadTask didWriteData:<span class="params">(int64_t)</span>bytesWritten totalBytesWritten:<span class="params">(int64_t)</span>totalBytesWritten totalBytesExpectedToWrite:<span class="params">(int64_t)</span>totalBytesExpectedToWrite
{
    double currentProgress = totalBytesWritten / <span class="params">(double)</span>totalBytesExpectedToWrite;
    NSLog<span class="params">(@<span class="string">"%@---%0.2f"</span>,self.identifier,current<span class="variable">Progress</span>)</span>;
}</span>
</code></pre><p>下载失败</p>
<pre><code><span class="pp">- <span class="params">(void)</span>URLSession:<span class="params">(<span class="variable">NSURLSession</span> *)</span>session downloadTask:<span class="params">(<span class="variable">NSURLSessionDownloadTask</span> *)</span>downloadTask didResumeAtOffset:<span class="params">(int64_t)</span>fileOffset expectedTotalBytes:<span class="params">(int64_t)</span>expectedTotalBytes
{
    // 下载失败
}</span>
</code></pre><p>下载成功</p>
<pre><code>- (<span class="keyword">void</span>)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(<span class="built_in">NSURL</span> *)location
{
    <span class="comment">// 下载成功后文件处理</span>
    <span class="built_in">NSFileManager</span> *fileManager = [<span class="built_in">NSFileManager</span> defaultManager];

    <span class="built_in">NSArray</span> *URLs = [fileManager URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask];
    <span class="built_in">NSURL</span> *documentsDirectory = URLs[<span class="number">0</span>];

    <span class="built_in">NSURL</span> *destinationPath = [documentsDirectory URLByAppendingPathComponent:<span class="keyword">self</span><span class="variable">.identifier</span>];
    <span class="built_in">NSError</span> *error;

    [fileManager removeItemAtURL:destinationPath error:<span class="literal">NULL</span>];
    <span class="built_in">BOOL</span> success = [fileManager copyItemAtURL:location toURL:destinationPath error:&amp;error];

    <span class="keyword">if</span> (success) {
        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^{
            <span class="comment">// 此处可更新UI</span>
        });
    } <span class="keyword">else</span> {
    }

    <span class="comment">// 下载成功后，下载任务处理，包括后台任务和普通任务区别，以及重启任务        </span>
    <span class="keyword">if</span>(downloadTask == <span class="keyword">self</span><span class="variable">.normalSessionTask</span>) {
        <span class="keyword">self</span><span class="variable">.normalSessionTask</span> = <span class="literal">nil</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (downloadTask == <span class="keyword">self</span><span class="variable">.resumeSessionTask</span>) {
        <span class="keyword">self</span><span class="variable">.resumeSessionTask</span> = <span class="literal">nil</span>;
        <span class="keyword">self</span><span class="variable">.partialData</span> = <span class="literal">nil</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (session == <span class="keyword">self</span><span class="variable">.backgroundSession</span>) {
        <span class="keyword">self</span><span class="variable">.backgroundSessionTask</span> = <span class="literal">nil</span>;

        AppDelegate *appDelegate = (AppDelegate *)[[<span class="built_in">UIApplication</span> sharedApplication] delegate];
        <span class="keyword">if</span>(appDelegate<span class="variable">.backgroundURLSessionCompletionHandler</span>) {
            <span class="keyword">void</span> (^handler)() = appDelegate<span class="variable">.backgroundURLSessionCompletionHandler</span>;
            appDelegate<span class="variable">.backgroundURLSessionCompletionHandler</span> = <span class="literal">nil</span>;
            handler();

            <span class="built_in">NSLog</span>(@<span class="string">"后台下载完成"</span>);
        }            
    }
}
</code></pre><p>9.后台下载完成，本地通知</p>
<pre><code>- (<span class="keyword">void</span>)showLocalNotification:(<span class="built_in">BOOL</span>)downloadSuc {
    <span class="built_in">UILocalNotification</span> *notification = [[<span class="built_in">UILocalNotification</span> alloc] init];
    <span class="keyword">if</span> (notification!=<span class="literal">nil</span>) {

        <span class="built_in">NSDate</span> *now=[<span class="built_in">NSDate</span> new];
        notification<span class="variable">.fireDate</span>=[now dateByAddingTimeInterval:<span class="number">6</span>]; 
        notification<span class="variable">.repeatInterval</span> = <span class="number">0</span>; 

        notification<span class="variable">.timeZone</span> = [NSTimeZone defaultTimeZone];
        notification<span class="variable">.soundName</span> = UILocalNotificationDefaultSoundName;
        notification<span class="variable">.alertBody</span> = downloadSuc ? @<span class="string">"后台下载成功啦"</span> : @<span class="string">"下载失败"</span>;
        notification<span class="variable">.alertAction</span> = @<span class="string">"打开"</span>;  
        notification<span class="variable">.hasAction</span> = <span class="literal">YES</span>;
        notification<span class="variable">.applicationIconBadgeNumber</span> =+ <span class="number">1</span>; 

        <span class="built_in">NSDictionary</span>* infoDic = [<span class="built_in">NSDictionary</span> dictionaryWithObject:@<span class="string">"value"</span> forKey:@<span class="string">"key"</span>];
        notification<span class="variable">.userInfo</span> = infoDic;
        [[<span class="built_in">UIApplication</span> sharedApplication] scheduleLocalNotification:notification];
    }
}    
</code></pre><h3 id="多任务下载">多任务下载</h3>
<p>多任务下载，基于单独任务下载实现。只是提供了统一的方法进行管理。</p>
<p>多任务下载采用单例管理</p>
<p>1.调用多任务下载，需要手动传入下载请求    </p>
<p>需要手动添加identifier，并通过identifier作为唯一标识，处理后续下载任务。</p>
<pre><code><span class="built_in">NSString</span> *identifier = [[NSProcessInfo processInfo] globallyUniqueString];

[[XZDownloadGroupManager shareInstance] addDownloadRequest:[musicUrlArr objectAtIndex:index] identifier:identifier targetSelf:<span class="keyword">self</span> showProgress:<span class="literal">YES</span> isDownloadBackground:<span class="literal">YES</span> downloadResponse:^(XZDownloadResponse *response) {
    [<span class="keyword">this</span> handleResponse:response];
}];
</code></pre><p>2.下载任务处理</p>
<p>这是下载模块处理最频繁的方法    </p>
<pre><code>- (void)handleResponse:(XZDownloadResponse *)<span class="built_in">response</span> {
    <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloading) {
        NSLog(@<span class="string">"下载任务ing%@"</span>,<span class="built_in">response</span>.identifier);
        XZDownloadView *downloadView = [self getDownloadView:<span class="built_in">response</span>.identifier];
        dispatch_async(dispatch_get_main_queue(), ^{
            downloadView.progressV = <span class="built_in">response</span>.progress;
        });
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadSuccuss) {
        NSLog(@<span class="string">"下载任务成功%@"</span>,<span class="built_in">response</span>.identifier);
        XZDownloadView *downloadView = [self getDownloadView:<span class="built_in">response</span>.identifier];
        downloadView.progressV = <span class="number">1.0</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadBackgroudSuccuss) {
        NSLog(@<span class="string">"后台下载任务成功%@"</span>,<span class="built_in">response</span>.identifier);
        [self showLocalNotification:YES];
        XZDownloadView *downloadView = [self getDownloadView:<span class="built_in">response</span>.identifier];
        downloadView.progressV = <span class="number">1.0</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadFail) {
        NSLog(@<span class="string">"下载任务失败%@"</span>,<span class="built_in">response</span>.identifier);
        [self showLocalNotification:NO];
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadCancle) {
        NSLog(@<span class="string">"下载任务取消%@"</span>,<span class="built_in">response</span>.identifier);
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadPause) {
        NSLog(@<span class="string">"下载任务暂停%@"</span>,<span class="built_in">response</span>.identifier);
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">response</span>.downloadStatus == XZDownloadResume) {
        NSLog(@<span class="string">"下载任务重启%@"</span>,<span class="built_in">response</span>.identifier);
    }
}
</code></pre><p>3.多任务的暂停、重启、取消    </p>
<p>暂停</p>
<pre><code><span class="attr_selector">[[XZDownloadGroupManager shareInstance]</span> <span class="tag">pauseAllDownloadRequest</span>];
</code></pre><p>重启</p>
<pre><code><span class="attr_selector">[[XZDownloadGroupManager shareInstance]</span> <span class="tag">resumeAllDownloadRequest</span>];
</code></pre><p>取消</p>
<pre><code><span class="attr_selector">[[XZDownloadGroupManager shareInstance]</span> <span class="tag">cancleAllDownloadRequest</span>];
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/05/02/多任务下载(支持后台下载)/" data-id="fby4fnn6a2k31u4p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XZDownloadTask/">XZDownloadTask</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-微信搜索效果" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/29/微信搜索效果/" class="article-date">
  <time datetime="2015-04-28T16:00:00.000Z" itemprop="datePublished">Apr 29 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/UISearchDisplayController/">UISearchDisplayController</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/29/微信搜索效果/">UISearchDisplayController，实现微信搜索效果</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/UISearchDisplayControllerDemo/master/Nav%20searchBar.gif" alt="Mou icon"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/UISearchDisplayControllerDemo" target="_blank" rel="external">https://github.com/kingundertree/UISearchDisplayControllerDemo</a></p>
<h3 id="功能比较简单，主要是展示下效果，需要用的直接拿走">功能比较简单，主要是展示下效果，需要用的直接拿走</h3>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/29/微信搜索效果/" data-id="69hf6hn8avp9tn6n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UISearchDisplayController/">UISearchDisplayController</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-XXMenuDemo，三栏式滑动菜单结构" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/29/XXMenuDemo，三栏式滑动菜单结构/" class="article-date">
  <time datetime="2015-04-28T16:00:00.000Z" itemprop="datePublished">Apr 29 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/XXMenuDemo/">XXMenuDemo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/29/XXMenuDemo，三栏式滑动菜单结构/">XXMenuDemo，三栏式滑动菜单结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/XXMenuDemo/master/XXMenuGif.gif" alt="Mou icon"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/XXMenuDemo" target="_blank" rel="external">https://github.com/kingundertree/XXMenuDemo</a></p>
<h3 id="说明">说明</h3>
<p>左右滑动，显示左侧菜单。这种交互在2014年比较火，我最喜欢的实现效果是华住app。不过后台他也改成tab结构。</p>
<p>这个Demo实在左侧菜单的基础上，增加为支持左右侧菜单。并且支持主视图缩放效果。</p>
<p>后面还附上swift版本github项目。</p>
<p>主要基于手势控制，以及缩放动画实现。再以及工程的设计思路。</p>
<p>并且添加的手势滑动返回功能，见：<a href="http://kingundertree.github.io/2015/04/24/手势滑动返回/" target="_blank" rel="external">http://kingundertree.github.io/2015/04/24/手势滑动返回/</a></p>
<h3 id="功能">功能</h3>
<ol>
<li>支持右滑，显示左侧菜单</li>
<li>支持左滑，显示右侧菜单</li>
<li>支持左右侧菜单滑动切换</li>
<li>支持手势滑动返回</li>
<li>支持滑动时，主视图平滑缩放效果</li>
</ol>
<h3 id="实现机制">实现机制</h3>
<ol>
<li>XXMenuVC基于viewController，add initWithRootViewController生成的PushBackNavigationController视图</li>
<li>赋予XXMenuVC给 self.window.rootViewController</li>
<li>在XXMenuVC add 左右菜单视图，并添加UITapGestureRecognizer、UIPanGestureRecognizer手势控制。</li>
<li>XXMenuVC视图的移动控制KVO实现</li>
<li>基于手势控制调整主视图的frame和缩放。</li>
<li>通过XXMenuVC控制视图切换和左右菜单的交互</li>
</ol>
<h3 id="使用方法">使用方法</h3>
<p>目前，所有功能都已经集成到XXMenuViewController中，需要定制XXLeftMenuView、XXRightMenuView。</p>
<p>1.初始化</p>
<p>在AppDelegate中add主视图XXMenuVC，并设置XXMenuVC为变量</p>
<pre><code>XXMainViewController *mainVC = [[XXMainViewController alloc] init];
PushBackNavigationController *nav = [[PushBackNavigationController alloc] initWithRootViewController:mainVC];
<span class="keyword">if</span> (SYSTEM_VERSION_LESS_THAN(@<span class="string">"7.0"</span>)) {
    [[<span class="built_in">UIApplication</span> sharedApplication] setStatusBarHidden:<span class="literal">TRUE</span>];
}
XXMenuVC = [[XXMenuViewController alloc] initWithRootVC:nav];
<span class="keyword">if</span> (SYSTEM_VERSION_LESS_THAN(@<span class="string">"7.0"</span>)) {
    [[<span class="built_in">UIApplication</span> sharedApplication] setStatusBarHidden:<span class="literal">NO</span>];
}

<span class="keyword">self</span><span class="variable">.window</span><span class="variable">.rootViewController</span> = XXMenuVC;
</code></pre><p>2.设置左右菜单view</p>
<pre><code><span class="attribute"> leftMenuView </span>=<span class="string"> [[XXLeftMenuView alloc] initWithFrame:frame];
 rightMenuView = [[XXRightMenuView alloc] initWithFrame:frame];</span>
</code></pre><p>3.显示隐藏左右菜单</p>
<pre><code><span class="pp">- <span class="params">(void)</span>showMenu:<span class="params">(<span class="variable">BOOL</span>)</span>isLeftMenu;</span>
</code></pre><p>4.设置初始化主视图</p>
<pre><code><span class="pp">- <span class="params">(id)</span>initWithRootVC:<span class="params">(<span class="variable">UIViewController</span> *)</span>controller</span>
</code></pre><p>5.左右菜单的操作事件，替换主视图</p>
<pre><code><span class="pp">- <span class="params">(void)</span>replaceRootVC:<span class="params">(<span class="variable">UIViewController</span> *)</span>replaceVC isFromLeft:</span>
</code></pre><p>6.XXMenuVC</p>
<p>主视图的所有交互通过XXMenuVC实现</p>
<pre><code><span class="attr_selector">[XXAppDelegate sharedAppDelegate]</span><span class="class">.XXMenuVC</span>
</code></pre><h3 id="swift版本">swift版本</h3>
<h4 id="github地址-1">github地址</h4>
<p>xcode6.3 编译正常通过</p>
<p>只实现主要功能，包括手势控制和左右菜单显示和隐藏</p>
<pre><code><span class="label">https:</span>//github<span class="preprocessor">.com</span>/kingundertree/XXMenuBySwiftDemo
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/29/XXMenuDemo，三栏式滑动菜单结构/" data-id="xx1uxbnkglqec7vd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XXMenuDemo/">XXMenuDemo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-多功能UITableViewCell菜单" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/29/多功能UITableViewCell菜单/" class="article-date">
  <time datetime="2015-04-28T16:00:00.000Z" itemprop="datePublished">Apr 29 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MultiFunctionCell/">MultiFunctionCell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/29/多功能UITableViewCell菜单/">多功能UITableViewCell菜单</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/MultiFunctionCell/master/multFunCell.gif" alt="Mou icon"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/MultiFunctionCell" target="_blank" rel="external">https://github.com/kingundertree/MultiFunctionCell</a></p>
<h3 id="功能">功能</h3>
<ol>
<li>支持定制UITableViewCell菜单，通过滑动UITableViewCell显示左右侧菜单选项</li>
<li>支持cell的重用，以及单个cell的菜单定制</li>
</ol>
<h3 id="实现机制">实现机制</h3>
<ol>
<li>定制UITableViewCell，在UITableViewCell.contentView上添加UIScrollView作为主视图，并绑定UIPanGestureRecognizer手势</li>
<li>定义左右菜单视图，置于UIScrollView之下</li>
<li>通过UIPanGestureRecognizer的事件控制UIScrollView的frame实现菜单的显示和隐藏</li>
<li>定制UITableView，通过OverLayViewDelegate控制罩层的显示和隐藏</li>
</ol>
<h3 id="使用方法">使用方法</h3>
<h5 id="UITableView">UITableView</h5>
<p>继承MultiFunctionTableView</p>
<pre><code>self<span class="preprocessor">.tableList</span> = [[MultiFunctionTableView alloc] initWithFrame:self<span class="preprocessor">.view</span><span class="preprocessor">.bounds</span> style:UITableViewStylePlain]<span class="comment">;</span>
self<span class="preprocessor">.tableList</span><span class="preprocessor">.delegate</span> = self<span class="comment">;</span>
self<span class="preprocessor">.tableList</span><span class="preprocessor">.dataSource</span> = self<span class="comment">;</span>
self<span class="preprocessor">.tableList</span><span class="preprocessor">.rowHeight</span> = <span class="number">80</span><span class="comment">;</span>
[self<span class="preprocessor">.view</span> addSubview:self<span class="preprocessor">.tableList</span>]<span class="comment">;</span>
</code></pre><p>Datasource的cellForRow方法中实现<br>HomeViewCell继承MultiFunctionCell即可，并设置cell.cellActionDelegate = self.tableList即可。其他都不用care了</p>
<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString *cellIdentify = @<span class="string">"cell"</span>;
    HomeViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellIdentify];
    <span class="keyword">if</span> (!cell) {
        cell = <span class="string">[[HomeViewCell alloc] initWithStyle:UITableViewCellStyleDefault
                                   reuseIdentifier:cellIdentify
                               containingTableView:tableView
                                leftUtilityButtons:@[@"left1"]
                               rightUtilityButtons:@[@"right1",@"right2"]]</span>;
        cell.cellActionDelegate = self.tableList;
        [cell configCell:<span class="keyword">nil</span> index:indexPath];
    }


    <span class="keyword">return</span> cell;
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/29/多功能UITableViewCell菜单/" data-id="mxpyj27pn9ha74ki" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MultiFunctionCell/">MultiFunctionCell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-手势滑动返回" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/24/手势滑动返回/" class="article-date">
  <time datetime="2015-04-23T16:00:00.000Z" itemprop="datePublished">Apr 24 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/手势滑动返回/">手势滑动返回</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/24/手势滑动返回/">手势滑动返回，多种实现方案</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="OC实现手势滑动控制viewCotroller_返回功能">OC实现手势滑动控制viewCotroller 返回功能</h3>
<h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/pushBackDemo/master/pushBack.gif" alt="Mou icon"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/pushBackDemo" target="_blank" rel="external">https://github.com/kingundertree/pushBackDemo</a></p>
<h3 id="主要功能">主要功能</h3>
<ol>
<li>支持iOS5~8，滑动viewController，实现页面返回</li>
<li>支持背景缩放和视差平滑2种模式</li>
<li>支持单个页面和多个页面pop，支持页面返回后通知</li>
<li>单个viewController禁用手势</li>
</ol>
<h3 id="设计思路">设计思路</h3>
<ol>
<li>继承UINavgationController，继承pushViewController方法。push的时候，依次调用[self capture]，截取上一个viewController并保存</li>
<li>UINavgationController的view上add GestureRecognizer，监听手势动作</li>
<li>手指右滑开始，将最新截图insertSubview: belowSubview:到当前view，并通过滑动距离，控制belowSubview的效果</li>
<li>popViewControllerAnimated或者popToViewController: animated:后，移除对应的截图</li>
</ol>
<h3 id="使用方法">使用方法</h3>
<p>1.继承PushBackNavgationController</p>
<pre><code>PushBackNavigationController *nav = [[PushBackNavigationController alloc] initWithRootViewController:MVC]<span class="comment">;</span>
self<span class="preprocessor">.window</span><span class="preprocessor">.rootViewController</span> = nav<span class="comment">;</span>
</code></pre><p>2.设置手势滑动效果，支持背景缩放和平滑</p>
<pre><code>typedef <span class="keyword">enum</span> {
    CaptureTypeWithView = <span class="number">0</span>,
    CaptureTypeWithWindow
}CaptureType; <span class="comment">//截图区域选择</span>
</code></pre><p>3.禁用某个页面手势</p>
<pre><code>在需要控制的viewController，引入pushBackLock
[pushBackLock setDisableGestureForBack:<span class="keyword">self</span><span class="variable">.navgationgationController</span> disable:<span class="literal">YES</span>]
如果禁用所有手势，则不继承PushBackNavgationController即可
</code></pre><h3 id="拦截iOS7_滑动返回手势">拦截iOS7 滑动返回手势</h3>
<h3 id="效果图">效果图</h3>
<p>见iOS7 系统自带原生手势滑动返回，但是控制区域在左侧10px位置，本demo支持viewController全部区域<br><img src="https://raw.githubusercontent.com/kingundertree/ExtensionNavGesForiOS7/master/extension.gif" alt="Mou icon"></p>
<h3 id="github地址-1">github地址</h3>
<p><a href="https://github.com/kingundertree/ExtensionNavGesForiOS7" target="_blank" rel="external">https://github.com/kingundertree/ExtensionNavGesForiOS7</a></p>
<h3 id="主要功能-1">主要功能</h3>
<ol>
<li>模拟iOS手势滑动返回效果</li>
<li>只支持iOS7 及以上版本</li>
<li>此方法比较简单，而且系统提供的手势滑动效果更加细腻。但是采用NSRunloop截取系统事件，使用需谨慎。</li>
</ol>
<h3 id="实现思路">实现思路</h3>
<ol>
<li>iOS7 开始，系统提供手势滑动返回功能，但是操作区域有限</li>
<li>设法截取系统手势事件，UINavgationController的interactivePopGestureRecognizer</li>
<li>自定义UIPanGestureRecognizer并add到UINavgationController的view上</li>
<li>截取interactivePopGestureRecognizer的target和action</li>
<li>把interactivePopGestureRecognizer的target和action，赋给自定义的手势上即可</li>
</ol>
<h3 id="使用方法-1">使用方法</h3>
<ol>
<li>继承ExtensionNav即可</li>
</ol>
<h3 id="NavigationInteractiveTransition_实现iOS7系统手势返回效果">NavigationInteractiveTransition 实现iOS7系统手势返回效果</h3>
<h3 id="效果图-1">效果图</h3>
<p>见iOS7 系统自带原生手势滑动返回，但是控制区域在左侧10px位置，本demo支持viewController全部区域<br><img src="https://raw.githubusercontent.com/kingundertree/ExtensionNavGesForiOS7/master/extension.gif" alt="Mou icon"></p>
<h3 id="github地址-2">github地址</h3>
<p><a href="https://github.com/kingundertree/TransitionPopForiOS7-" target="_blank" rel="external">https://github.com/kingundertree/TransitionPopForiOS7-</a></p>
<h3 id="主要功能-2">主要功能</h3>
<ol>
<li>模拟iOS手势滑动返回效果</li>
<li>只支持iOS7 及以上版本</li>
</ol>
<h3 id="实现思路-1">实现思路</h3>
<ol>
<li>设法截取系统手势事件，UINavgationController的interactivePopGestureRecognizer</li>
<li>通过ISO7提供的转场动画事件NavigationInteractiveTransition，创建新的action</li>
<li>在action中计算progress，分别实现updateInteractiveTransition、finishInteractiveTransition、cancelInteractiveTransition事件即可</li>
</ol>
<h3 id="使用方法-2">使用方法</h3>
<ol>
<li>继承ExtensionNav即可</li>
</ol>
<h3 id="swift_语言实现手势滑动返回效果">swift 语言实现手势滑动返回效果</h3>
<h4 id="github地址-3">github地址</h4>
<p>效果同上，采用swift语言重新实现。</p>
<p><a href="https://github.com/kingundertree/PushBackBySwiftDemo" target="_blank" rel="external">https://github.com/kingundertree/PushBackBySwiftDemo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/04/24/手势滑动返回/" data-id="wdqm8j0o8mht3gwk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UIPanGuesture/">UIPanGuesture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-UITableView重用机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/16/UITableView重用机制/" class="article-date">
  <time datetime="2015-03-15T16:00:00.000Z" itemprop="datePublished">Mar 16 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hexo/">hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/16/UITableView重用机制/">UITableView 重用机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在看这个瀑布流的项目：<a href="https://github.com/pingyourid/waterView" target="_blank" rel="external">https://github.com/pingyourid/waterView</a></p>
<p>他自称是可以重用的，看到最后发现，这个demo的瀑布流功能做的蛮深入的。</p>
<p>他通过设置reuseIdentifier，视图滚动时进进出出实现视图的重复利用。区别于UITableView的UITableViewCell的重用机制，瀑布流Demo完全实现了手动控制。</p>
<p>UITableView虽然用了无数次，但是一直没有自习整理过他的重用机制。今天统一整理下，也方便日后实现自定义的重复功能。</p>
<h4 id="重用">重用</h4>
<ol>
<li>重用机制，主要用在UIScollView视图中，子视图会频繁上下滑动，但是自子视图的结构非常类似。通过重用，避免大量的内存开销。尤其是在iphone 单核时代。</li>
<li>UITableView在cellForRow方法中dequeueReusableCellWithIdentifier设置重用标记。</li>
<li>当面屏幕中所显示的子视图都是真实存在，相互之间不重用。但是当前子视图可以重用已经init但是已经移除视图外的子视图。</li>
</ol>
<h4 id="实现机制">实现机制</h4>
<p>假如当前屏幕UITableView 可以最多显示6个cell，用3种不同的cell，也就是需要设置3个不同的identifier。</p>
<ol>
<li>cellForRow最多生成可以占满屏幕的cell，也就是6个。这个时候，所有的cell都不会加入到reuse cell queue。也就是生成了2组不同identifier的cell，共6个。</li>
<li>向上滑动，生成第7个cell。</li>
<li>继续滑动，第1个cell隐藏时，此cell加入reuse cell queue。</li>
<li>向上滑动，生成第8个cell。</li>
<li>继续滑动，第2个cell隐藏时，此cell加入reuse cell queue。</li>
<li>向上滑动，生成第9个cell。</li>
<li>继续滑动，第3个cell隐藏时，此cell加入reuse cell queue。</li>
<li>向上滑动，生成第10个cell。</li>
<li>此时dequeueReusableCellWithIdentifier可以从reuse cell queue获取到reuse cell，就不在创建新的cell，直接返回，重新配置数据即可，并把此cell从队列去移除。</li>
<li>到第12个cell，都是此逻辑。然后每3个cell以此往复。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/16/UITableView重用机制/" data-id="51njtefr5jozgf2f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UITableView/">UITableView</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-XZPageViewController" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/16/XZPageViewController/" class="article-date">
  <time datetime="2015-03-15T16:00:00.000Z" itemprop="datePublished">Mar 16 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/UIPageViewController/">UIPageViewController</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/16/XZPageViewController/">XZPageViewController 类似搜狐新闻切换效果</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="先上效果图">先上效果图</h3>
<p><img src="https://raw.githubusercontent.com/kingundertree/XZPageViewController/master/pageControl.gif" alt="Mou icon"></p>
<h3 id="github地址">github地址</h3>
<p><a href="https://github.com/kingundertree/XZPageViewController" target="_blank" rel="external">https://github.com/kingundertree/XZPageViewController</a></p>
<h3 id="说明">说明</h3>
<p>见过一些类似的设计，但是很多都是采用UIScrollView，add viewController，然后自己监控UIScrollView的变化值实现导航和viewController的通讯，甚至有采用UITableView横过来的方式实现，深不以为然。一方面是实现成本大，操作麻烦，再就是viewController的生命周期需要单独控制等。</p>
<p>更推崇系统提供的UIPageViewController方法，这个方法本来是方便实现类似读书软件的翻页效果。</p>
<h3 id="功能">功能</h3>
<ol>
<li>支持左右滑动快速切换viewController</li>
<li>支持viewController和导航的相互控制</li>
<li>支持viewController的切换效果和循环滚动</li>
</ol>
<h3 id="实现机制">实现机制</h3>
<ol>
<li>基于UIPageViewController以及其UIPageViewControllerDataSource，UIPageViewControllerDelegate</li>
<li>通过UIPageViewControllerDataSource 为 UIPageViewController 添加 viewControllerBeforeViewController 或 viewControllerAfterViewController ，实现视图的切换</li>
<li>通过UIPageViewControllerDelegate，通知实现导航效果切换</li>
<li>通过setViewControllers，实现点击导航切换viewcontrollers</li>
</ol>
<h3 id="使用方法">使用方法</h3>
<p>目前，所有功能都已经集成到XZPageViewController中，只继承XZPageViewController，然后实现XZPageViewControllerDataSource,XZPageViewControllerDelegate。</p>
<h5 id="XZPageViewControllerDataSource">XZPageViewControllerDataSource</h5>
<p>1.设置导航数量</p>
<pre><code><span class="pp">- <span class="params">(float)</span>numOfPages;</span>
</code></pre><p>2.设置导航宽度</p>
<pre><code><span class="pp">- <span class="params">(float)</span>witdhOfNav;</span>
</code></pre><p>3.导航标题</p>
<pre><code><span class="pp">- <span class="params">(<span class="variable">NSString</span> *)</span>titleOfNavAtIndex:<span class="params">(<span class="variable">NSInteger</span>)</span>index;</span>
</code></pre><p>4.设置viewController</p>
<pre><code><span class="pp">- <span class="params">(<span class="variable">UIViewController</span> *)</span>viewPageController:<span class="params">(<span class="variable">XZPageViewController</span> *)</span>pageViewController contentViewControllerForNavAtIndex:<span class="params">(<span class="variable">NSInteger</span>)</span>index;</span>
</code></pre><p>5.是否循环</p>
<pre><code><span class="pp">- <span class="params">(<span class="variable">BOOL</span>)</span>canPageViewControllerRecycle;</span>
</code></pre><p>6.导航切换，viewcontroller是否动画展示</p>
<pre><code><span class="pp">- <span class="params">(<span class="variable">BOOL</span>)</span>canPageViewControllerAnimation;</span>
</code></pre><h5 id="XZPageViewControllerDelegate">XZPageViewControllerDelegate</h5>
<p>1.viewController切换成功事件</p>
<pre><code><span class="pp">-<span class="params">(<span class="variable">UIViewController</span> *)</span>viewPageController:<span class="params">(<span class="variable">XZPageViewController</span> *)</span>pageViewController pageViewControllerChangedAtIndex:<span class="params">(<span class="variable">NSInteger</span>)</span>index;</span>
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/16/XZPageViewController/" data-id="4jlnv3h59zpi5kc1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UIPageViewController/">UIPageViewController</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MultiFunctionCell/">MultiFunctionCell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/UIPageViewController/">UIPageViewController</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/UISearchDisplayController/">UISearchDisplayController</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/XXMenuDemo/">XXMenuDemo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/XZDownloadTask/">XZDownloadTask</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/XZMusic/">XZMusic</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/XZNetworking/">XZNetworking</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/swift/">swift</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/webapp/">webapp</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/手势滑动返回/">手势滑动返回</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MultiFunctionCell/">MultiFunctionCell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UIPageViewController/">UIPageViewController</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UIPanGuesture/">UIPanGuesture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UISearchDisplayController/">UISearchDisplayController</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UITableView/">UITableView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XXMenuDemo/">XXMenuDemo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XZDownloadTask/">XZDownloadTask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XZMusic/">XZMusic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XZNetworking/">XZNetworking</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift-oc/">swift oc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webapp/">webapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/产品/">产品</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a><span class="tag-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/MultiFunctionCell/" style="font-size: 10.00px;">MultiFunctionCell</a><a href="/tags/UIPageViewController/" style="font-size: 10.00px;">UIPageViewController</a><a href="/tags/UIPanGuesture/" style="font-size: 10.00px;">UIPanGuesture</a><a href="/tags/UISearchDisplayController/" style="font-size: 10.00px;">UISearchDisplayController</a><a href="/tags/UITableView/" style="font-size: 10.00px;">UITableView</a><a href="/tags/XXMenuDemo/" style="font-size: 10.00px;">XXMenuDemo</a><a href="/tags/XZDownloadTask/" style="font-size: 10.00px;">XZDownloadTask</a><a href="/tags/XZMusic/" style="font-size: 10.00px;">XZMusic</a><a href="/tags/XZNetworking/" style="font-size: 10.00px;">XZNetworking</a><a href="/tags/hexo/" style="font-size: 10.00px;">hexo</a><a href="/tags/jekyll/" style="font-size: 10.00px;">jekyll</a><a href="/tags/swift-oc/" style="font-size: 10.00px;">swift oc</a><a href="/tags/webapp/" style="font-size: 20.00px;">webapp</a><a href="/tags/产品/" style="font-size: 15.00px;">产品</a><a href="/tags/随笔/" style="font-size: 20.00px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05">May 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04">April 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03">March 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07">July 2013</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06">June 2013</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08">August 2011</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/11/README/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/05/11/XZNetworking请求库/">XZNetworking 支持get/post/restfulGet/restfulPost请求</a>
          </li>
        
          <li>
            <a href="/2015/05/02/XZMusic构架设计/">XZMusic构架设计</a>
          </li>
        
          <li>
            <a href="/2015/05/02/多任务下载(支持后台下载)/">多任务下载(支持后台下载)</a>
          </li>
        
          <li>
            <a href="/2015/04/29/微信搜索效果/">UISearchDisplayController，实现微信搜索效果</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://reqianduan.com">热前端</a>
          </li>
        
          <li>
            <a href="http://xiguabaobao.com">西瓜宝宝主题站</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 xiazer<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank" rel="external nofollow">Hexo</a>
      .
      Theme by <a href="http://xiguabaobao.com/" target="_blank" rel="external nofollow">西瓜宝宝</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>